# 多模态 RAG 问答系统

这是一个先进的多模态检索增强生成（RAG）平台，旨在构建一个以视觉为核心的"图片知识库"。本系统能够深度理解图像内容，并将其与文本描述无缝结合，提供强大的跨模态检索与分析能力。它不仅是一个问答工具，更是一个可扩展的基础设施，尤其适用于内容安全审核、工业质检、版权保护等视觉密集型场景。
![截屏2025-06-28 14.53.05.png](./截屏2025-06-28%2014.53.05.png)

## ✨ 系统特点

### 以图片特征为核心的知识库能力
当前许多多模态RAG方案本质上是"图片OCR+文本检索"的模式。该方法首先通过光学字符识别（OCR）提取图片中的文字，然后将这些文字与用户问题进行传统的文本匹配。这种模式存在两个致命缺陷：
1.  **视觉特征丢失**：图片中最核心的视觉信息，如物体、场景、色彩、构图、情感氛围等，在OCR过程中被完全忽略。系统无法理解"图片本身在说什么"。
2.  **图文关联割裂**：图片和其附带的文本（如图说、描述）被当成独立数据处理，它们之间深度的语义关联被切断。

**解决方案**：系统通过采用先进的图文双编码器（如CLIP系列），将图片和文本映射到同一个语义空间中。这意味着系统不再是基于关键词匹配，而是基于概念和语义的理解。亲测对于图片风控审核领域有奇效。

### 本系统优势
- **图特征优先的跨模态理解**: 系统深度解析图像的视觉内容，并与文本描述进行语义融合，实现真正的跨模态检索。你可以用图片搜文字，用文字搜图片，或者图文混合搜索。
- **高度模块化与可扩展性**: 本系统是一个通用的多模态应用框架，而非仅仅一个问答工具。其核心组件——编码器、向量数据库、生成模型——均采用可拔插设计，允许开发者像搭乐高一样自由组合和替换。
    - **编码器 (Encoders)**: 支持多种视觉编码器（如 `CLIP`, `CN-CLIP`, `DINOv2`），并可轻松扩展。
    - **向量数据库 (Vector Stores)**: 支持 `Faiss`（基于内存）和 `Milvus`（分布式可扩展）的分层存储策略，满足不同业务规模的需求。
    - **生成模型 (Generators)**: 可对接 `Hugging Face` 开源社区模型、`OpenAI API`、`Azure OpenAI` 等多种大语言模型。
- **在线标注与数据探查**: 提供可视化的在线标注工具与数据集查看能力，方便用户进行数据验证、管理和修正。
- **端到端解决方案**: 提供从数据上传、多模态索引、混合检索到生成式问答的全流程功能，并包含可视化的操作界面，开箱即用。


## 🚀 快速启动教程

手把手教你如何在本地启动一个多模态RAG系统
### 步骤一：创建并激活Conda环境

为了隔离项目依赖，避免与系统或其他项目的库产生冲突，建议使用Conda创建一个专属的Python环境。

1. **创建Conda环境** (我们使用Python 3.10作为示例亲测可用):
    ```bash
    conda create -n multi_rag python=3.10
    ```
2. **激活**
    ```bash
    conda activate multi_rag
    ```
### 步骤三：安装项目依赖

项目所需的所有Python库都记录在 `requirements.txt` 文件中。

```bash
pip install -r requirements.txt
```
这个过程可能需要几分钟，请耐心等待所有库（特别是`torch`, `faiss-cpu`, `cn-clip`等）安装完成。

### 步骤四：下载核心模型

为了避免应用在运行时才去下载模型（这可能会因为网络问题导致失败或极其缓慢），我们提供了一个专门的脚本来预先下载核心的`cn-clip`模型。

```bash
python download_model.py
```
此脚本会将模型文件下载到`cn-clip`库默认的缓存目录 (`~/.cache/clip/`)。当然也可以替换自己想用的模型。

### 步骤五：启动Streamlit应用

```bash
KMP_DUPLICATE_LIB_OK=TRUE python -m streamlit run ui.py
```
在 Windows 系统上，请先设置环境变量再运行：
```bash
set KMP_DUPLICATE_LIB_OK=TRUE
python -m streamlit run ui.py
```

### 步骤六：在浏览器中配置和使用

应用成功启动后，它会自动在您的浏览器中打开一个新标签页。

1.  **系统配置**:![截屏2025-06-28 15.16.23.png](./截屏2025-06-28%2015.16.23.png)
    -   默认打开的是 **"⚙️ 配置"** 选项卡。
    -   选择您要使用的语言模型服务商（如 "OpenAI API"）。
    -   在对应的输入框中填入您的 **API Key** 和 **Base URL** (如果需要)。
    -   点击 **"应用配置"** 按钮。等待加载动画完成，并出现成功提示。

2.  **数据管理**:
    -   切换到 **"📚 数据管理"** 选项卡。
    -   您可以下载数据模板，参照格式准备您自己的商品数据（CSV或Excel格式）。
    -   点击 **"上传数据文件"** 并选择您的数据文件。
    -   上传成功后，点击 **"开始建立索引"** 按钮。等待进度条走完，直到出现成功提示。
![截屏2025-06-28 15.17.51.png](./截屏2025-06-28%2015.17.51.png)
3.  **开始问答**:
    -   当索引建立完成后，切换到 **"💬 开始问答"** 选项卡。
    -   现在，您可以通过上传图片、输入文本，或两者结合的方式，向系统提问了！
![截屏2025-06-28 15.34.34.png](./截屏2025-06-28%2015.34.34.png)
![截屏2025-06-28 15.34.45.png](./截屏2025-06-28%2015.34.45.png)
---
## 🗺️ 项目路线图 (Roadmap)

### v1.0 (当前版本)
- **核心功能**: 提供从数据上传、多模态索引、混合检索到生成式问答的端到端全流程能力。
- **编码模型**: 采用可插拔设计，已支持`CLIP`, `CN-CLIP`, `DINOv2`等多种业界主流的图文编码器。
- **向量存储**:
    - **`Faiss`**: 用于本地开发和快速验证，简单高效。
    - **`Milvus`**: 用于构建可扩展、高可用的生产级系统（当前版本需在代码中配置连接信息）。
- **生成模型**: 灵活对接`Hugging Face`开源社区模型、`OpenAI API`、`Azure OpenAI`等多种大语言模型。
- **交互界面**: 基于Streamlit提供可视化的操作界面，支持系统配置、数据管理和多模态问答。

### 未来规划
- **🚀 检索能力增强 (Retrieval Enhancement)**
    - **高级重排（Reranking）**: 集成重排模型（如`BGE-M3-Reranker`），对初步检索的Top-K结果进行二次排序，提升最终答案的精准度。
    - **查询重写（Query Rewriting）**: 引入查询理解与重写模块，自动优化用户的输入，处理模糊或复杂的查询，提升检索系统的鲁棒性。
    - **高效剪枝与过滤（Pruning & Filtering）**: 在大规模数据场景下，开发基于元数据的高效过滤或向量剪枝算法，在保证精度的前提下，大幅提升检索速度。

- **✨ 功能与易用性 (Features & Usability)**
    - **在线配置数据库**: 将`Milvus`等向量数据库的配置参数移至UI界面，实现零代码动态初始化和连接。
    - **知识图谱可视化**: 增加知识图谱探索功能，将图文关联以网络图形式展示，帮助用户直观理解数据间的关系。

## 项目结构
```
.
├── README.md
├── ui.py                 # Streamlit UI 界面主程序
├── index_data.py         # 数据索引构建脚本
├── retrieve.py           # 检索逻辑实现
├── prompts.py            # LLM的提示模板
├── configs/              # 配置文件目录
│   └── config.py
├── encoders/             # 编码器模型
│   ├── __init__.py
│   ├── clip_encoder.py
│   └── dinov2_encoder.py
├── generators/           # 生成器（大语言模型）
│   ├── __init__.py
│   ├── openai_generator.py
│   └── bedrock_generator.py
├── stores/               # 向量数据库存储
│   ├── __init__.py
│   ├── faiss_store.py
│   └── milvus_store.py
├── dataset/              # 示例数据集
├── pics/                 # 项目图片资源
├── requirements.txt      # Python 依赖
└── download_model.py     # 模型下载脚本
```
---
欢迎大家使用，如有问题可issue